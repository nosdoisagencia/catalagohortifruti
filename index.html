<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hortifruti Vit√≥ria | Cat√°logo</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --verde-primario: #2ecc71;
            --verde-escuro: #219150;
            --laranja: #f39c12;
            --bg-leve: #f1f2f6;
            --texto: #2d3436;
            --vermelho: #e74c3c;
            --branco: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; scroll-behavior: smooth; }
        body { background: var(--bg-leve); margin: 0; color: var(--texto); padding-bottom: 120px; }

        header { 
            background: linear-gradient(135deg, var(--verde-escuro), var(--verde-primario));
            color: white; padding: 50px 20px; text-align: center;
            border-radius: 0 0 40px 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .badge-status { padding: 6px 16px; border-radius: 50px; font-size: 13px; font-weight: bold; margin-bottom: 15px; display: inline-block; transition: 0.3s; }
        .status-aberto { background: rgba(255,255,255,0.2); border: 1px solid white; }
        .status-fechado { background: var(--vermelho); border: 1px solid white; }

        .container { max-width: 1100px; margin: auto; padding: 0 15px; }

        .search-container { position: relative; margin-top: -30px; z-index: 10; }
        .search-box { 
            width: 100%; padding: 20px 30px; border-radius: 50px; border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); font-size: 16px; outline: none;
        }

        .categories { display: flex; gap: 12px; overflow-x: auto; padding: 25px 5px; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .cat-btn { 
            background: var(--branco); border: none; padding: 12px 22px; border-radius: 20px; 
            cursor: pointer; font-weight: 600; white-space: nowrap; box-shadow: var(--shadow);
            transition: 0.3s; color: var(--texto);
        }
        .cat-btn.active { background: var(--verde-escuro); color: white; transform: scale(1.05); }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        @media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); gap: 25px; } }

        .card { background: var(--branco); border-radius: 22px; overflow: hidden; display: flex; flex-direction: column; box-shadow: var(--shadow); position: relative; }
        .card img { width: 100%; height: 160px; object-fit: cover; background: #eee; }
        .card-body { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
        .card-body h3 { font-size: 14px; margin: 5px 0; text-align: center; height: 40px; overflow: hidden; line-height: 1.3; }
        .price { color: var(--verde-escuro); font-weight: 700; font-size: 18px; margin: 8px 0; }
        .label-peso { font-size: 10px; color: var(--laranja); font-weight: bold; text-transform: uppercase; }

        .qty-controls { display: flex; align-items: center; justify-content: space-between; width: 100%; background: #f8f9fa; border-radius: 12px; padding: 5px; margin-top: auto; }
        .btn-qty { background: var(--verde-primario); color: white; border: none; width: 35px; height: 35px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 18px; }

        .cart-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; background: var(--laranja); color: white;
            padding: 18px 25px; border-radius: 20px; display: none;
            justify-content: space-between; align-items: center; cursor: pointer; z-index: 999;
            box-shadow: 0 10px 25px rgba(243, 156, 18, 0.4);
        }

        #btn-topo {
            position: fixed; bottom: 85px; right: 20px;
            background: var(--verde-escuro); color: white; width: 45px; height: 45px;
            border-radius: 50%; border: none; cursor: pointer; display: none;
            align-items: center; justify-content: center; z-index: 998;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s;
        }

        .checkout-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 2000; display: none; flex-direction: column; }
        .checkout-modal.active { display: flex; }

        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 5px; color: #666; }
        .input-field { width:100%; padding:14px; border-radius:12px; border:1px solid #ddd; font-size: 15px; background: #fdfdfd; }

        .aviso-peso { background: #fff3cd; color: #856404; padding: 12px; border-radius: 10px; font-size: 12px; margin-bottom: 15px; border: 1px solid #ffeeba; display: none; align-items: center; gap: 8px; }

        footer { background: #2d3436; color: white; padding: 40px 20px; text-align: center; margin-top: 50px; border-radius: 30px 30px 0 0; }
        footer a { color: var(--verde-primario); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div id="status-loja" class="badge-status">Verificando...</div><br>
    <h1 style="margin: 0; font-size: 28px;">Hortifruti Vit√≥ria</h1>
    <p style="margin: 5px 0; opacity: 0.9;"><i class="fas fa-motorcycle"></i> Qualidade e Frescor no Vieiralves</p>
</header>

<div class="container">
    <div class="search-container">
        <input type="text" id="busca" class="search-box" placeholder="O que voc√™ procura hoje?" onkeyup="filtrar()">
    </div>

    <div class="categories" id="filtros">
        <button class="cat-btn active" onclick="filtrarCat('Todos', this)">üåø Todos</button>
        <button class="cat-btn" onclick="filtrarCat('Ofertas', this)">üî• Ofertas</button>
        <button class="cat-btn" onclick="filtrarCat('Frutas', this)">üçé Frutas</button>
        <button class="cat-btn" onclick="filtrarCat('Legumes', this)">ü•¶ Legumes</button>
        <button class="cat-btn" onclick="filtrarCat('Regional', this)">üèπ Regional</button>
        <button class="cat-btn" onclick="filtrarCat('Padaria', this)">ü•ñ Padaria</button>
        <button class="cat-btn" onclick="filtrarCat('Bebidas', this)">ü•§ Bebidas</button>
        <button class="cat-btn" onclick="filtrarCat('Sucos & Polpas', this)">üçπ Sucos & Polpas</button>
        <button class="cat-btn" onclick="filtrarCat('Praticidade', this)">üî™ Praticidade</button>
    </div>

    <div id="lista-produtos" class="grid"></div>
</div>

<button id="btn-topo" onclick="window.scrollTo(0,0)"><i class="fas fa-arrow-up"></i></button>

<div class="cart-bar" id="cart-bar" onclick="toggleModal(true)">
    <div><i class="fas fa-shopping-basket"></i> <span id="cart-count">0</span> itens</div>
    <div id="cart-total" style="font-weight: bold; font-size: 18px;">R$ 0,00 ‚ûî</div>
</div>

<div class="checkout-modal" id="checkout-modal">
    <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px;">
        <button onclick="toggleModal(false)" style="border:none; background:#eee; padding:10px 15px; border-radius:10px; cursor:pointer;"><i class="fas fa-chevron-left"></i></button>
        <h2 style="margin:0; font-size: 20px;">Finalizar Pedido</h2>
    </div>
    
    <div style="padding: 20px; overflow-y: auto; flex-grow: 1;">
        <div id="num-pedido-exibicao" style="font-weight: bold; color: var(--laranja); margin-bottom: 15px; font-size: 14px;"></div>
        
        <div id="aviso-pesagem" class="aviso-peso">
            <i class="fas fa-balance-scale"></i>
            <span>Itens com * est√£o sujeitos a pesagem final.</span>
        </div>

        <div id="itens-carrinho" style="margin-bottom: 20px;"></div>
        
        <div class="input-group">
            <label>Nome Completo</label>
            <input type="text" id="nome-cliente" class="input-field" placeholder="Como te chamamos?">
        </div>

        <div class="input-group">
            <label>Tipo de Pedido</label>
            <select id="tipo-pedido" class="input-field" onchange="toggleEntrega()">
                <option value="Entrega">Receber em Casa (Entrega)</option>
                <option value="Retirada">Retirar na Loja</option>
            </select>
        </div>

        <div id="campos-entrega">
            <div class="input-group">
                <label>Bairro</label>
                <select id="bairro-entrega" class="input-field">
                    <option value="0">Vieiralves (Entrega Gr√°tis)</option>
                    <option value="A combinar">Outro bairro (Taxa a combinar)</option>
                </select>
            </div>
            <div class="input-group">
                <label>Endere√ßo e Refer√™ncia</label>
                <input type="text" id="endereco-cliente" class="input-field" placeholder="Rua, n√∫mero e apto">
            </div>
        </div>

        <div class="input-group">
            <label>Forma de Pagamento</label>
            <select id="pagamento" class="input-field">
                <option value="Pix">Pix (Receber chave no WhatsApp)</option>
                <option value="Cart√£o">Cart√£o (Na entrega/retirada)</option>
                <option value="Dinheiro">Dinheiro</option>
            </select>
        </div>

        <div id="resumo-financeiro" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 12px; text-align: right;"></div>
        
        <button onclick="enviarWhatsApp()" style="background: #25d366; color: white; width: 100%; padding: 20px; border: none; border-radius: 15px; font-weight: 700; cursor:pointer; font-size: 18px;">
            <i class="fab fa-whatsapp"></i> ENVIAR PEDIDO
        </button>
    </div>
</div>

<footer>
    <p><b>Hortifruti Vit√≥ria</b></p>
    <p>üìç Rua Amap√°, n¬∫ 19 - Vieiralves</p>
    <p>Seg a S√°b: 07h √†s 22h | Dom: 07h √†s 16h</p>
    <hr style="opacity: 0.1; margin: 20px 0;">
    <p>üì∏ Siga-nos tamb√©m no instagram: <a href="https://instagram.com/hortifruti_vitoria" target="_blank">@hortifruti_vitoria</a></p>
</footer>

<script>
    const URL_PLANILHA = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfG9ACYb6dSnGeHioNdZpLL11MLm0FakxrhxMbL4ctyvRp-jAKNV7qz3zInyuaEIM7TbXAiUlo3upR/pub?gid=0&single=true&output=csv";
    let produtos = [];
    let carrinho = {};
    let categoriaAtual = "Todos";
    let numeroPedidoAtual = "";

    window.onscroll = function() {
        const btn = document.getElementById("btn-topo");
        if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
            btn.style.display = "flex";
        } else { btn.style.display = "none"; }
    };

    function gerarNumeroPedido() {
        const data = new Date();
        const dia = data.getDate().toString().padStart(2, '0');
        const mes = (data.getMonth() + 1).toString().padStart(2, '0');
        const random = Math.floor(1000 + Math.random() * 9000);
        return `${dia}${mes}-${random}`;
    }

    function verificarHorario() {
        const agora = new Date();
        const horaManaus = agora.getUTCHours() - 4;
        const hora = horaManaus < 0 ? horaManaus + 24 : horaManaus;
        const dia = agora.getDay();
        const statusEl = document.getElementById('status-loja');
        let aberto = false;
        if (dia >= 1 && dia <= 6) { if (hora >= 7 && hora < 22) aberto = true; }
        else { if (hora >= 7 && hora < 16) aberto = true; }
        statusEl.innerText = aberto ? "‚óè LOJA ABERTA" : "‚óè LOJA FECHADA";
        statusEl.className = "badge-status " + (aberto ? "status-aberto" : "status-fechado");
    }

    async function buscarProdutos() {
        try {
            const response = await fetch(URL_PLANILHA);
            const data = await response.text();
            const linhas = data.split('\n').slice(1);
            produtos = linhas.map(linha => {
                const col = linha.split(',');
                const preco = parseFloat(col[3]);
                const cat = col[1]?.trim();
                const nome = col[2]?.trim();
                
                // L√≥gica de Ofertas Autom√°ticas: Pre√ßos baixos ou categoria espec√≠fica
                let eOferta = (cat === 'Ofertas' || preco < 6.00 || nome.toLowerCase().includes('saca') || nome.toLowerCase().includes('promo'));

                return {
                    id: col[0]?.trim(),
                    cat: cat,
                    nome: nome,
                    preco: preco,
                    pesavel: col[4]?.trim().toLowerCase() === 'sim',
                    img: col[5]?.trim(),
                    oferta: eOferta
                };
            }).filter(p => p.nome);
            render();
        } catch (e) { console.error("Erro ao carregar planilha"); }
    }

    function render() {
        const termo = document.getElementById('busca').value.toLowerCase();
        const grid = document.getElementById('lista-produtos');
        
        const filtrados = produtos.filter(p => {
            const matchesSearch = p.nome.toLowerCase().includes(termo);
            if (categoriaAtual === "Todos") return matchesSearch;
            if (categoriaAtual === "Ofertas") return matchesSearch && p.oferta;
            
            // Agrupamentos solicitados
            if (categoriaAtual === "Sucos & Polpas") return matchesSearch && (p.cat === "Sucos" || p.cat === "Polpas");
            if (categoriaAtual === "Praticidade") return matchesSearch && p.cat === "Frutas Cortadas";
            
            return matchesSearch && p.cat === categoriaAtual;
        });

        grid.innerHTML = filtrados.map(p => {
            const qtd = carrinho[p.id] ? carrinho[p.id].qtd : 0;
            return `<div class="card">
                <img src="${p.img}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1617/1617554.png'">
                <div class="card-body">
                    <span class="label-peso">${p.pesavel ? 'Item por KG' : 'Unidade'}</span>
                    <h3>${p.nome}</h3>
                    <div class="price">R$ ${p.preco.toFixed(2).replace('.',',')}</div>
                    ${qtd === 0 ? 
                        `<button onclick="mudarQtd('${p.id}', 1)" style="background:var(--verde-primario); color:white; border:none; padding:12px; width:100%; border-radius:12px; font-weight:bold; cursor:pointer;">Adicionar</button>` :
                        `<div class="qty-controls">
                            <button class="btn-qty" onclick="mudarQtd('${p.id}', -1)">-</button>
                            <span style="font-weight:bold">${qtd}</span>
                            <button class="btn-qty" onclick="mudarQtd('${p.id}', 1)">+</button>
                        </div>`}
                </div>
            </div>`;
        }).join('');
    }

    function mudarQtd(id, delta) {
        if (!carrinho[id]) {
            const p = produtos.find(prod => prod.id === id);
            carrinho[id] = { ...p, qtd: 0 };
        }
        carrinho[id].qtd += delta;
        if (carrinho[id].qtd <= 0) delete carrinho[id];
        atualizarBarra();
        render();
    }

    function filtrarCat(cat, btn) {
        categoriaAtual = cat;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render();
    }

    function filtrar() { render(); }

    function atualizarBarra() {
        const itens = Object.values(carrinho).reduce((acc, p) => acc + p.qtd, 0);
        const total = Object.values(carrinho).reduce((acc, p) => acc + (p.preco * p.qtd), 0);
        document.getElementById('cart-bar').style.display = itens > 0 ? 'flex' : 'none';
        document.getElementById('cart-count').innerText = itens;
        document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2).replace('.',',')} ‚ûî`;
    }

    function toggleEntrega() {
        const tipo = document.getElementById('tipo-pedido').value;
        document.getElementById('campos-entrega').style.display = tipo === 'Entrega' ? 'block' : 'none';
    }

    function toggleModal(show) {
        document.getElementById('checkout-modal').classList.toggle('active', show);
        if (show) {
            numeroPedidoAtual = gerarNumeroPedido();
            document.getElementById('num-pedido-exibicao').innerText = `PEDIDO #${numeroPedidoAtual}`;
            let temPesavel = false;
            const div = document.getElementById('itens-carrinho');
            div.innerHTML = Object.values(carrinho).map(p => {
                if (p.pesavel) temPesavel = true;
                return `<div style="display:flex; justify-content:space-between; margin-bottom:8px">
                    <span>${p.pesavel ? '*' : ''}${p.qtd}x ${p.nome}</span>
                    <span>R$ ${(p.preco * p.qtd).toFixed(2).replace('.',',')}</span>
                </div>`;
            }).join('');
            document.getElementById('aviso-pesagem').style.display = temPesavel ? 'flex' : 'none';
            atualizarTotal();
        }
    }

    function atualizarTotal() {
        const total = Object.values(carrinho).reduce((acc, p) => acc + (p.preco * p.qtd), 0);
        document.getElementById('resumo-financeiro').innerHTML = `<b style="font-size:20px; color:var(--verde-escuro);">Total: R$ ${total.toFixed(2).replace('.',',')}</b>`;
    }

    function enviarWhatsApp() {
        const nome = document.getElementById('nome-cliente').value;
        const tipo = document.getElementById('tipo-pedido').value;
        const pag = document.getElementById('pagamento').value;
        if (!nome) return alert("Por favor, informe seu nome.");
        
        let msg = `*PEDIDO #${numeroPedidoAtual} - HORTIFRUTI VIT√ìRIA*\n`;
        msg += `üë§ *Cliente:* ${nome}\nüì¶ *Tipo:* ${tipo}\nüí≥ *Pag:* ${pag}\n`;
        
        if (tipo === 'Entrega') {
            const end = document.getElementById('endereco-cliente').value;
            if(!end) return alert("Informe o endere√ßo.");
            msg += `üìç *Bairro:* ${document.getElementById('bairro-entrega').value === '0' ? 'Vieiralves' : 'Outro'}\nüè† *End:* ${end}\n`;
        }

        msg += `\n*ITENS:*\n`;
        let temPesavel = false;
        Object.values(carrinho).forEach(p => {
            if(p.pesavel) temPesavel = true;
            msg += `‚Ä¢ ${p.qtd}x ${p.nome} ${p.pesavel ? '(*)' : ''}\n`;
        });
        
        const total = Object.values(carrinho).reduce((acc, p) => acc + (p.preco * p.qtd), 0);
        msg += `\nüí∞ *VALOR TOTAL: R$ ${total.toFixed(2).replace('.',',')}*`;
        if (temPesavel) msg += `\n\n_(*) Sujeito a pesagem final._`;

        window.open(`https://wa.me/5592994498445?text=${encodeURIComponent(msg)}`);
    }

    verificarHorario();
    buscarProdutos();
</script>
</body>
</html>
