<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hortifruti Vit√≥ria | Cat√°logo</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --verde-primario: #2ecc71;
            --verde-escuro: #27ae60;
            --laranja: #f39c12;
            --bg-leve: #f8f9fa;
            --texto: #2d3436;
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg-leve); margin: 0; color: var(--texto); padding-bottom: 120px; }

        header { 
            background: linear-gradient(135deg, var(--verde-escuro), var(--verde-primario));
            color: white; padding: 40px 20px; text-align: center;
            border-radius: 0 0 30px 30px;
        }

        .container { max-width: 1000px; margin: auto; padding: 0 15px; }

        .search-container { position: relative; margin-top: -25px; z-index: 10; }
        .search-box { 
            width: 100%; padding: 18px 25px; border-radius: 50px; border: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); font-size: 16px; outline: none;
        }

        /* Produtos */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        @media (min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); } }

        .card { background: white; border-radius: 18px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 140px; object-fit: cover; }
        .card-body { padding: 12px; flex-grow: 1; text-align: center; }
        .price { color: var(--verde-escuro); font-weight: 700; font-size: 18px; margin: 5px 0; }
        .label-peso { font-size: 10px; color: var(--laranja); font-weight: bold; display: block; margin-bottom: 5px; }

        /* Carrinho Laranja */
        .cart-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; background: var(--laranja); color: white;
            padding: 15px 25px; border-radius: 25px; display: none;
            justify-content: space-between; align-items: center; cursor: pointer; z-index: 999;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        /* Bot√£o WhatsApp Compacto */
        .whatsapp-float {
            position: fixed; bottom: 85px; right: 20px;
            background: #25d366; color: white; width: 60px; height: 60px;
            border-radius: 50px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; text-decoration: none;
            transition: width 0.3s ease; overflow: hidden;
        }
        .whatsapp-float span { display: none; white-space: nowrap; font-weight: bold; margin-left: 10px; }
        .whatsapp-float:hover { width: 220px; }
        .whatsapp-float:hover span { display: inline; }

        /* Checkout e Aviso */
        .checkout-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1001; display: none; flex-direction: column; }
        .checkout-modal.active { display: flex; }
        .aviso-peso { background: #fff3cd; color: #856404; padding: 12px; border-radius: 10px; font-size: 12px; margin-bottom: 15px; border: 1px solid #ffeeba; display: none; align-items: center; gap: 8px; }

        footer { background: #333; color: white; padding: 30px 20px; text-align: center; margin-top: 40px; font-size: 14px; }
    </style>
</head>
<body>

<header>
    <h1>Hortifruti Vit√≥ria</h1>
    <p><i class="fas fa-motorcycle"></i> Entregas no Vieiralves</p>
</header>

<div class="container">
    <div class="search-container">
        <input type="text" id="busca" class="search-box" placeholder="Buscar no hortifruti..." onkeyup="filtrar()">
    </div>
    <div id="lista-produtos" class="grid"></div>
</div>

<a href="LINK_DO_SEU_GRUPO" class="whatsapp-float" target="_blank">
    <i class="fab fa-whatsapp" style="font-size: 30px;"></i>
    <span>Grupo de Ofertas</span>
</a>

<div class="cart-bar" id="cart-bar" onclick="toggleModal(true)">
    <div><i class="fas fa-shopping-basket"></i> <span id="cart-count">0</span> itens</div>
    <div id="cart-total">R$ 0,00 ‚ûî</div>
</div>

<div class="checkout-modal" id="checkout-modal">
    <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
        <button onclick="toggleModal(false)" style="border:none; background:none; font-size: 18px;"><i class="fas fa-arrow-left"></i> Voltar</button>
        <h2 style="margin:0;">Seu Carrinho</h2>
        <div></div>
    </div>
    <div style="padding: 20px; overflow-y: auto; flex-grow: 1;">
        <div id="aviso-pesagem" class="aviso-peso">
            <i class="fas fa-balance-scale"></i>
            <span>Item sujeito a pesagem final.</span>
        </div>
        <div id="itens-carrinho"></div>
        <div id="total-final" style="margin: 20px 0; font-weight: bold; font-size: 20px; text-align: right; color: var(--verde-escuro);"></div>
        
        <input type="text" id="nome-cliente" placeholder="Seu Nome" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;">
        <input type="text" id="endereco-cliente" placeholder="Endere√ßo de Entrega" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd;">
        <button onclick="enviarWhatsApp()" style="background: var(--verde-escuro); color: white; width: 100%; padding: 18px; border: none; border-radius: 10px; font-weight: bold; cursor:pointer;">FINALIZAR PEDIDO</button>
    </div>
</div>

<footer>
    <p>üìç Rua Amap√°, n¬∫ 19 - Conjunto Vieiralves</p>
    <p>üì∏ Instagram: @hortifruti_vitoria | üìû (92) 99449-8445</p>
</footer>

<script>
    const URL_PLANILHA = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfG9ACYb6dSnGeHioNdZpLL11MLm0FakxrhxMbL4ctyvRp-jAKNV7qz3zInyuaEIM7TbXAiUlo3upR/pub?gid=0&single=true&output=csv";
    let produtos = [];
    let carrinho = {};

    async function buscarProdutos() {
        const response = await fetch(URL_PLANILHA);
        const data = await response.text();
        const linhas = data.split('\n').slice(1);
        produtos = linhas.map(linha => {
            const col = linha.split(',');
            return {
                id: col[0],
                nome: col[2],
                preco: parseFloat(col[3]),
                pesavel: col[4].trim().toLowerCase() === 'sim',
                img: col[5]
            };
        });
        render();
    }

    function render() {
        const grid = document.getElementById('lista-produtos');
        grid.innerHTML = produtos.map(p => `
            <div class="card">
                <img src="${p.img}">
                <div class="card-body">
                    ${p.pesavel ? '<span class="label-peso">Item sujeito a pesagem final</span>' : ''}
                    <h3>${p.nome}</h3>
                    <div class="price">R$ ${p.preco.toFixed(2)}</div>
                    <button onclick="mudarQtd('${p.id}', 1)" style="background:var(--verde-primario); color:white; border:none; padding:10px; width:100%; border-radius:10px; font-weight:bold; cursor:pointer;">Adicionar</button>
                </div>
            </div>`).join('');
    }

    function mudarQtd(id, delta) {
        if (!carrinho[id]) carrinho[id] = { ...produtos.find(p => p.id === id), qtd: 0 };
        carrinho[id].qtd += delta;
        if (carrinho[id].qtd <= 0) delete carrinho[id];
        atualizarBarra();
    }

    function atualizarBarra() {
        const itens = Object.values(carrinho).reduce((acc, p) => acc + p.qtd, 0);
        const total = Object.values(carrinho).reduce((acc, p) => acc + (p.preco * p.qtd), 0);
        document.getElementById('cart-bar').style.display = itens > 0 ? 'flex' : 'none';
        document.getElementById('cart-count').innerText = itens;
        document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2)} ‚ûî`;
    }

    function toggleModal(show) {
        document.getElementById('checkout-modal').classList.toggle('active', show);
        if (show) {
            let temPesavel = false;
            const itensDiv = document.getElementById('itens-carrinho');
            const subtotal = Object.values(carrinho).reduce((acc, p) => acc + (p.preco * p.qtd), 0);
            
            itensDiv.innerHTML = Object.values(carrinho).map(p => {
                if (p.pesavel) temPesavel = true;
                return `<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span>${p.pesavel ? '*' : ''}${p.qtd}x ${p.nome}</span>
                    <span>R$ ${(p.preco * p.qtd).toFixed(2)}</span>
                </div>`;
            }).join('');
            
            document.getElementById('total-final').innerText = `Total: R$ ${subtotal.toFixed(2)}`;
            document.getElementById('aviso-pesagem').style.display = temPesavel ? 'flex' : 'none';
        }
    }

    function enviarWhatsApp() {
        const nome = document.getElementById('nome-cliente').value;
        if (!nome) return alert("Por favor, informe seu nome.");
        let msg = `*PEDIDO - HORTIFRUTI VIT√ìRIA*\n\nCliente: ${nome}\n\n`;
        Object.values(carrinho).forEach(p => {
            msg += `‚Ä¢ ${p.qtd}x ${p.nome} ${p.pesavel ? '(*)' : ''}\n`;
        });
        const total = Object.values(carrinho).reduce((acc, p) => acc + (p.preco * p.qtd), 0);
        msg += `\n*TOTAL: R$ ${total.toFixed(2)}*`;
        msg += `\n\n_(*) Itens sujeitos a pesagem final._`;
        window.open(`https://wa.me/5592994498445?text=${encodeURIComponent(msg)}`);
    }

    buscarProdutos();
</script>
</body>
</html>
